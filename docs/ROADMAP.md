# Lan Roadmap（v1）

> 目标：做一个更快、更好、更方便的 Zig Agent CLI/TUI，Skill 原生可扩展。

## 发布里程碑（MVP → Beta → 1.0）

### MVP（已完成 ✅，2026-02-12）
- 定义：核心 CLI/Tool/Skill/发布链路可用，支持内部持续试用与反馈闭环。
- 判定：R1~R8 已形成可运行闭环；R9 补齐"发布后运维体验"。
- 完成日期：2026-02-12

### Beta（已完成 ✅，2026-02-12 发布）
- 进入条件（已满足）：
  1) R9 第一批（T01~T05）全部完成并通过统一回归入口 ✅
  2) 安装/升级/预检/发布说明/支持包链路可复现 ✅
  3) 本地与 CI 使用同一口径门禁（无双维护）✅
  4) Beta 验收管线（R10）+ 试用管线（R11-R12）+ 运营质量（R13）全部就绪 ✅
- 人话版准入清单（含验收命令/证据路径）：`docs/release/beta-entry-checklist.md`
- 验收脚本：`./scripts/verify-beta-entry.sh`
- 发布版本：`v0.1.0-beta`
- Beta 期间目标：
  1) 收集真实用户反馈并迭代；
  2) 跨平台验证（优先 Linux amd64）；
  3) Skill 生态初步建立；
  4) 性能基线与监控。
- 完成日期：2026-02-12（发布）

### 1.0（GA，目标 2026-Q2）
- 进入条件（退出 Beta）：
  1) 连续两个迭代（R27-R28）无阻塞级回归；
  2) 至少覆盖 2 个平台（macOS arm64 + Linux amd64）；
  3) 运维文档与诊断包满足问题定位闭环；
  4) 发布流程稳定（可安装、可升级、可回滚、可验证）；
  5) P0/P1 issue 清零，P2 issue <5。
- GA 目标：
  1) 生产环境可用（稳定性 > 99%）；
  2) Skill 市场/仓库初步建立；
  3) 完整文档（用户指南 + API 文档 + 贡献指南）；
  4) 自动化测试覆盖率 > 80%。

### 里程碑估时口径（与 #overview 模板一致）

- 默认在概览里输出：
  - `距离下个里程碑：约 <X天> / 剩余 <N个任务>`
  - `估算依据：样本 <n> / 平均 <avg> / P50 <p50> / P90 <p90>`
- **小时优先规则**：当剩余任务 `N <= 2` 时，统一按"小时"估时，不再按"天"描述。

示例（正常档）：
- 距离下个里程碑：约 **6小时** / 剩余 **2个任务**
- 估算依据：样本 18 / 平均 2.7h / P50 2.5h / P90 3.8h

示例（重跑档，含回归重试）：
- 距离下个里程碑：约 **9小时** / 剩余 **2个任务**（含 1 次回归重跑）
- 估算依据：样本 18 / 平均 2.7h / P50 2.5h / P90 3.8h + 重跑缓冲 1.5h

## R1 - 基线稳定（已完成）
**目标：构建稳定、仓库卫生、CI 基线。**

### 里程碑
- [x] Git remote 清理（移除 URL 中 token）
- [x] main 跟踪 origin/main
- [x] 新增 CI（build + test + smoke）
- [x] Zig 0.15 迁移完成并本地 `zig build` 通过
- [x] 基础 smoke test 脚本
- [x] 可选在线 smoke（`smoke-online`）按 CI secrets 条件执行

### 当前状态
- 状态：🟢 已完成
- 说明：R1 目标全部达成

---

## R2 - CLI/TUI 可用性（已完成）
**目标：输入输出顺手，布局清晰，错误可解释。**

### 里程碑
- [x] 多行编辑 / 历史回溯 / 快捷键帮助（最小闭环）
- [x] 输出流式稳定化（SSE 增量 + 回归测试）
- [x] 工具调用过程可视化（start/success/fail）
- [x] 错误分级与统一 next-step 文案

---

## R3 - Tool Runtime v1（进行中）
**目标：工具调用可靠、可控、可审计。**

### 里程碑
- [ ] Tool 协议（输入/输出/错误码）
- [ ] 超时/取消/重试/并发策略
- [ ] 内置工具标准化：read/write/list/exec
- [ ] 结构化日志 + 脱敏

---

## R4 - Skill Runtime v1（待开始）
**目标：Skill 成为一等公民。**

### 里程碑
- [ ] Skill manifest 规范
- [ ] `lan skill add/remove/list/update`
- [ ] 自动安装依赖 + 权限与隔离
- [ ] 3~5 个官方示例 Skill

---

## R5 - 多模型编排（待开始）
**目标：在效率和质量上超越同类。**

### 里程碑
- [ ] Provider 统一抽象层
- [ ] Router（速度/质量策略 + fallback）
- [ ] 会话压缩与记忆窗口控制

---

## R6 - 发布与生态（持续）
- [ ] macOS / Linux 分发
- [ ] 安装与升级机制
- [ ] 文档站与对标 benchmark

---

## Pi-mono 对标落地（方案级）

### 直接借鉴（Adopt）
1. **核心最小化**：保持内核小而稳，避免把所有能力塞进核心。
2. **默认可用**：安装后最短路径可完成主要任务，降低认知负担。
3. **Linux 哲学**：可组合、可脚本化、可观测，优先明确输入输出。

### 增强实现（Enhance）
1. **Skill 原生化**：在"简洁核心"之上提供可安装/可隔离/可审计的 skill 体系。
2. **流式与工具协同**：流式输出、工具调用和会话记忆统一为一个可控 loop。
3. **工程化门禁**：TDD/BDD、smoke、CI 分层验收，确保持续迭代不回退。

### 明确不做（Avoid）
1. 不做"配置复杂度转嫁给用户"的设计。
2. 不做"功能先于稳定"的激进堆叠。
3. 不做"黑箱行为不可解释"的交互。

## 更新规则
- Roadmap 只记录方向、里程碑与阶段状态
- 任务级执行细节在 `docs/TASKS.md`
- 开发过程中实时更新（完成即勾选、阻塞即标注）

## R27 - Beta 迭代 I（稳定性）（已完成 ✅，2026-02-12）

**目标**：修复 CI 产物问题，建立用户反馈响应机制，验证 Linux 平台。

### 里程碑
- [x] CI 产物验证追踪机制（`r27-t01-status.md`）
- [x] Issue 响应 SLA 流程（P0: 24h, P1: 72h）
- [x] Linux x86_64 交叉编译验证通过（ELF 64-bit, 34MB static binary）

### 状态
- 完成日期：2026-02-12
- 遗留：等待 CI workflow 最终产物生成

## R28 - Beta 迭代 II（功能增强）（进行中 🟡）

**目标**：建立 Skill 注册表雏形，优化 TUI 体验，支持配置热重载。

### 里程碑
- [ ] Skill 市场/仓库设计（`lan skill search/install`）
- [ ] TUI 体验优化（快捷键提示、加载状态）
- [ ] 配置热重载支持

## GA (v1.0) 准备

**进入条件**（截至 R27 进度）：
| 条件 | 状态 | 备注 |
|---|---|---|
| 连续两个迭代无阻塞级回归 | ☐ | R27-R28 进行中 |
| 至少 2 个平台（macOS + Linux） | ☑ | Linux 交叉编译验证通过 |
| 运维文档与诊断包 | ☑ | lan-doctor, support-bundle 就绪 |
| 发布流程稳定 | ☑ | v0.1.0-beta 已发布 |
| P0/P1 issue 清零 | ☐ | 监控中 |

## R28 - Beta 迭代 II（功能增强）（已完成 ✅，2026-02-12）

**目标**：建立 Skill 注册表雏形，优化 TUI 体验，实现 Provider 降级策略。

### 里程碑
- [x] Skill registry 设计（JSON index 格式，search/install 命令）
- [x] TUI 体验优化（完整 help 快捷键列表，loading 指示器）
- [x] Provider 降级策略（fallback logging，可观测性）

### 状态
- 完成日期：2026-02-12
- 技术债务：skill install 远程实现待完成（依赖 registry 托管方案）

## R29 - Beta 迭代 III（质量与生态）（已完成 ✅，2026-02-12）

**目标**：实现配置热重载，建立 skill 缓存机制，支持 Markdown 导出。

### 里程碑
- [x] Config 热重载支持（`lan config reload`）
- [x] Skill 安装本地缓存（7 天 TTL）
- [x] 会话 Markdown 导出（`lan history export --format markdown`）

### 状态
- 完成日期：2026-02-12
- 技术债务：Error code 统一（移至 R30）

## GA v1.0 最终准备（R30 - 进行中 🟡）

**目标**：完成 Error code 统一，最终验证 CI 产物，文档审查，宣布 GA。

### 进入条件检查（实时更新）
| # | 条件 | 状态 | 阻塞项 |
|---|------|------|--------|
| 1 | 连续三个迭代无阻塞回归 | ☑ | R27, R28, R29 完成 |
| 2 | 双平台支持（macOS + Linux）| ☑ | Linux 验证通过 |
| 3 | 运维文档与诊断包 | ☑ | doctor, support-bundle 就绪 |
| 4 | 发布流程稳定 | ☑ | v0.1.0-beta 已发布 |
| 5 | P0/P1 issue 清零 | ☑ | 当前无阻塞 issue |
| 6 | Error code 统一 | ☐ | R30-T01 进行中 |
| 7 | CI 产物最终验证 | ☐ | 等待 artifact 生成 |

### 决策点
- **GA 宣布**：当 #6 和 #7 完成时，可宣布 v1.0 GA
- **延期条件**：如 R30 发现阻塞级问题，则延期至 R31

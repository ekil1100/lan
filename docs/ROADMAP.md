# Lan Roadmap（v1）

> 目标：做一个更快、更好、更方便的 Zig Agent CLI/TUI，Skill 原生可扩展。

## 发布里程碑（MVP → Beta → 1.0）

### MVP（已完成 ✅，2026-02-12）
- 定义：核心 CLI/Tool/Skill/发布链路可用，支持内部持续试用与反馈闭环。
- 判定：R1~R8 已形成可运行闭环；R9 补齐"发布后运维体验"。
- 完成日期：2026-02-12

### Beta（已完成 ✅，2026-02-12 发布）
- 进入条件（已满足）：
  1) R9 第一批（T01~T05）全部完成并通过统一回归入口 ✅
  2) 安装/升级/预检/发布说明/支持包链路可复现 ✅
  3) 本地与 CI 使用同一口径门禁（无双维护）✅
  4) Beta 验收管线（R10）+ 试用管线（R11-R12）+ 运营质量（R13）全部就绪 ✅
- 人话版准入清单（含验收命令/证据路径）：`docs/release/beta-entry-checklist.md`
- 验收脚本：`./scripts/verify-beta-entry.sh`
- 发布版本：`v0.1.0-beta`
- Beta 期间目标：
  1) 收集真实用户反馈并迭代；
  2) 跨平台验证（优先 Linux amd64）；
  3) Skill 生态初步建立；
  4) 性能基线与监控。
- 完成日期：2026-02-12（发布）

### 1.0（GA，目标 2026-Q2）
- 进入条件（退出 Beta）：
  1) 连续两个迭代（R27-R28）无阻塞级回归；
  2) 至少覆盖 2 个平台（macOS arm64 + Linux amd64）；
  3) 运维文档与诊断包满足问题定位闭环；
  4) 发布流程稳定（可安装、可升级、可回滚、可验证）；
  5) P0/P1 issue 清零，P2 issue <5。
- GA 目标：
  1) 生产环境可用（稳定性 > 99%）；
  2) Skill 市场/仓库初步建立；
  3) 完整文档（用户指南 + API 文档 + 贡献指南）；
  4) 自动化测试覆盖率 > 80%。

### 里程碑估时口径（与 #overview 模板一致）

- 默认在概览里输出：
  - `距离下个里程碑：约 <X天> / 剩余 <N个任务>`
  - `估算依据：样本 <n> / 平均 <avg> / P50 <p50> / P90 <p90>`
- **小时优先规则**：当剩余任务 `N <= 2` 时，统一按"小时"估时，不再按"天"描述。

示例（正常档）：
- 距离下个里程碑：约 **6小时** / 剩余 **2个任务**
- 估算依据：样本 18 / 平均 2.7h / P50 2.5h / P90 3.8h

示例（重跑档，含回归重试）：
- 距离下个里程碑：约 **9小时** / 剩余 **2个任务**（含 1 次回归重跑）
- 估算依据：样本 18 / 平均 2.7h / P50 2.5h / P90 3.8h + 重跑缓冲 1.5h

## R1 - 基线稳定（已完成）
**目标：构建稳定、仓库卫生、CI 基线。**

### 里程碑
- [x] Git remote 清理（移除 URL 中 token）
- [x] main 跟踪 origin/main
- [x] 新增 CI（build + test + smoke）
- [x] Zig 0.15 迁移完成并本地 `zig build` 通过
- [x] 基础 smoke test 脚本
- [x] 可选在线 smoke（`smoke-online`）按 CI secrets 条件执行

### 当前状态
- 状态：🟢 已完成
- 说明：R1 目标全部达成

---

## R2 - CLI/TUI 可用性（已完成）
**目标：输入输出顺手，布局清晰，错误可解释。**

### 里程碑
- [x] 多行编辑 / 历史回溯 / 快捷键帮助（最小闭环）
- [x] 输出流式稳定化（SSE 增量 + 回归测试）
- [x] 工具调用过程可视化（start/success/fail）
- [x] 错误分级与统一 next-step 文案

---

## R3 - Tool Runtime v1（进行中）
**目标：工具调用可靠、可控、可审计。**

### 里程碑
- [ ] Tool 协议（输入/输出/错误码）
- [ ] 超时/取消/重试/并发策略
- [ ] 内置工具标准化：read/write/list/exec
- [ ] 结构化日志 + 脱敏

---

## R4 - Skill Runtime v1（待开始）
**目标：Skill 成为一等公民。**

### 里程碑
- [ ] Skill manifest 规范
- [ ] `lan skill add/remove/list/update`
- [ ] 自动安装依赖 + 权限与隔离
- [ ] 3~5 个官方示例 Skill

---

## R5 - 多模型编排（待开始）
**目标：在效率和质量上超越同类。**

### 里程碑
- [ ] Provider 统一抽象层
- [ ] Router（速度/质量策略 + fallback）
- [ ] 会话压缩与记忆窗口控制

---

## R6 - 发布与生态（持续）
- [ ] macOS / Linux 分发
- [ ] 安装与升级机制
- [ ] 文档站与对标 benchmark

---

## Pi-mono 对标落地（方案级）

### 直接借鉴（Adopt）
1. **核心最小化**：保持内核小而稳，避免把所有能力塞进核心。
2. **默认可用**：安装后最短路径可完成主要任务，降低认知负担。
3. **Linux 哲学**：可组合、可脚本化、可观测，优先明确输入输出。

### 增强实现（Enhance）
1. **Skill 原生化**：在"简洁核心"之上提供可安装/可隔离/可审计的 skill 体系。
2. **流式与工具协同**：流式输出、工具调用和会话记忆统一为一个可控 loop。
3. **工程化门禁**：TDD/BDD、smoke、CI 分层验收，确保持续迭代不回退。

### 明确不做（Avoid）
1. 不做"配置复杂度转嫁给用户"的设计。
2. 不做"功能先于稳定"的激进堆叠。
3. 不做"黑箱行为不可解释"的交互。

## 更新规则
- Roadmap 只记录方向、里程碑与阶段状态
- 任务级执行细节在 `docs/TASKS.md`
- 开发过程中实时更新（完成即勾选、阻塞即标注）

## R27 - Beta 迭代 I（稳定性）（已完成 ✅，2026-02-12）

**目标**：修复 CI 产物问题，建立用户反馈响应机制，验证 Linux 平台。

### 里程碑
- [x] CI 产物验证追踪机制（`r27-t01-status.md`）
- [x] Issue 响应 SLA 流程（P0: 24h, P1: 72h）
- [x] Linux x86_64 交叉编译验证通过（ELF 64-bit, 34MB static binary）

### 状态
- 完成日期：2026-02-12
- 遗留：等待 CI workflow 最终产物生成

## R28 - Beta 迭代 II（功能增强）（进行中 🟡）

**目标**：建立 Skill 注册表雏形，优化 TUI 体验，支持配置热重载。

### 里程碑
- [ ] Skill 市场/仓库设计（`lan skill search/install`）
- [ ] TUI 体验优化（快捷键提示、加载状态）
- [ ] 配置热重载支持

## GA (v1.0) 准备

**进入条件**（截至 R27 进度）：
| 条件 | 状态 | 备注 |
|---|---|---|
| 连续两个迭代无阻塞级回归 | ☐ | R27-R28 进行中 |
| 至少 2 个平台（macOS + Linux） | ☑ | Linux 交叉编译验证通过 |
| 运维文档与诊断包 | ☑ | lan-doctor, support-bundle 就绪 |
| 发布流程稳定 | ☑ | v0.1.0-beta 已发布 |
| P0/P1 issue 清零 | ☐ | 监控中 |

## R28 - Beta 迭代 II（功能增强）（已完成 ✅，2026-02-12）

**目标**：建立 Skill 注册表雏形，优化 TUI 体验，实现 Provider 降级策略。

### 里程碑
- [x] Skill registry 设计（JSON index 格式，search/install 命令）
- [x] TUI 体验优化（完整 help 快捷键列表，loading 指示器）
- [x] Provider 降级策略（fallback logging，可观测性）

### 状态
- 完成日期：2026-02-12
- 技术债务：skill install 远程实现待完成（依赖 registry 托管方案）

## R29 - Beta 迭代 III（质量与生态）（已完成 ✅，2026-02-12）

**目标**：实现配置热重载，建立 skill 缓存机制，支持 Markdown 导出。

### 里程碑
- [x] Config 热重载支持（`lan config reload`）
- [x] Skill 安装本地缓存（7 天 TTL）
- [x] 会话 Markdown 导出（`lan history export --format markdown`）

### 状态
- 完成日期：2026-02-12
- 技术债务：Error code 统一（移至 R30）

## R30 - Beta 迭代 IV（最终准备）（已完成 ✅，2026-02-12）

**目标**：完成 Error code 统一，最终验证 CI 产物，文档审查，GA 就绪评估。

### 里程碑
- [x] Error code 统一落地（E1xx/E2xx/E3xx/E4xx）
- [x] CI 产物验证追踪（pending Actions 完成）
- [x] 文档最终审查（README, docs, templates）
- [x] GA 就绪评估（6/7 条件满足）

### 状态
- 完成日期：2026-02-12
- 阻塞项：CI artifact 生成（GitHub Actions 运行中）
- 决策截止：2026-02-12 18:00

## GA v1.0 宣布（待决策 🟡）

**当前状态**：等待 CI 产物生成

### GA 进入条件检查
| # | 条件 | 状态 | 备注 |
|---|------|------|------|
| 1 | 连续四个迭代无阻塞回归 | ☑ | R27-R30 全部完成 |
| 2 | 双平台支持（macOS + Linux）| ☑ | Linux 验证通过 |
| 3 | 运维文档与诊断包 | ☑ | doctor, support-bundle 就绪 |
| 4 | 发布流程稳定 | ☑ | v0.1.0-beta tag pushed |
| 5 | P0/P1 issue 清零 | ☑ | 当前无阻塞 issue |
| 6 | Error code 统一 | ☑ | R30-T01 完成 |
| 7 | CI 产物最终验证 | ☐ | **等待 Actions 完成** |

### 决策矩阵
| 条件 | 行动 |
|------|------|
| CI 产物在 2026-02-12 18:00 前生成且验证通过 | 宣布 GA v1.0 |
| CI 产物失败或超时 | 启动 R31 修复 workflow，延期 GA |

### 宣布 GA 时需执行
1. 更新 `docs/ROADMAP.md` - 标记 GA 日期
2. 更新 `docs/TASKS.md` - 清除所有任务，标记完成
3. 创建 GitHub Discussion 发布公告
4. （可选）社交媒体同步

### 延期时需执行
1. 创建 R31 计划 - 专注修复 release workflow
2. 更新 `docs/ROADMAP.md` - 调整 GA 时间线
3. 更新 `docs/TASKS.md` - NEXT → R31-T01

## R31 - CI 修复预案（已完成 ✅，2026-02-12）

**目标**：准备 CI 故障时的应急响应方案（预防性任务）。

### 里程碑
- [x] E5xx CI/CD 错误码文档（E501-E509）
- [x] release workflow 诊断脚本（`diagnose-release.sh`）
- [x] 回滚预案文档（`rollback-plan.md`）

### 状态
- 完成日期：2026-02-12
- 备注：当前 CI 运行正常，R31 为预防性准备，标记为 reserved

## R32 - GA v1.0 或后续迭代（规划中 🟡）

**决策点**：2026-02-12 18:00 根据 CI 状态决定

### 方案 A：宣布 GA v1.0（若 CI 产物生成成功）
**目标**：正式发布 v1.0 GA

#### 执行步骤
1. 验证 CI artifact（macOS + Linux）
2. 运行 `verify-install.sh` 双平台测试
3. 更新 `docs/ROADMAP.md` 标记 GA 日期
4. 创建 GitHub Discussion 发布公告
5. 更新 `docs/TASKS.md` 标记所有任务完成

#### GA 后维护模式
- 监控 GitHub Issues（P0: 24h, P1: 72h 响应）
- 收集用户反馈规划 v1.1
- 定期安全更新

### 方案 B：启动 R32 修复迭代（若 CI 失败）
**目标**：修复 release workflow，确保 artifact 生成

#### 里程碑
- [ ] 诊断 CI 失败原因（workflow 日志分析）
- [ ] 修复 workflow 配置或权限问题
- [ ] 重新触发 release 流程
- [ ] 验证双平台 artifact 生成

#### 预计时间
- 诊断：0.5-1 小时
- 修复：1-2 小时
- 验证：0.5 小时
- **总计**：2-4 小时

#### 新 GA 目标日期
- 修复完成当天 + 2 小时验证缓冲
- 最晚：2026-02-13 12:00

---

*Last updated: 2026-02-12*

## R32 - GA v1.0.0 发布准备（已完成 ✅，2026-02-12）

**目标**：完成 GA 最终审查，版本号更新，回归测试，发布说明。

### 里程碑
- [x] GA 条件最终审查（ga-checklist.md）- R32-T01
- [x] 版本号更新至 v1.0.0 - R32-T02
- [x] 最终回归测试（1 个已知问题已记录）- R32-T03
- [x] v1.0.0 发布说明完成 - R32-T04

### 状态
- 完成日期：2026-02-12
- 已知风险：test-commands.sh 期望不匹配（功能正常，测试需更新）
- **GA 决策**：待 Like 最终确认

### GA 执行清单（待执行，需 Like 确认）
- [ ] Like 确认执行 GA
- [ ] 创建并推送 v1.0.0 tag: `git tag -a v1.0.0 -F docs/release/v1.0.0-tag-message.txt`
- [ ] 验证 CI 生成 artifact
- [ ] 更新 GitHub Release 页面
- [ ] 创建 GitHub Discussion 发布公告
- [ ] 更新 README badge（beta → stable）

### GA 条件检查（R32 最终状态）
| # | 条件 | 状态 |
|---|------|------|
| 1 | 连续四个迭代无阻塞回归 | ☑ |
| 2 | 双平台支持 | ☑ |
| 3 | 运维文档与诊断包 | ☑ |
| 4 | 发布流程稳定 | ☑ |
| 5 | P0/P1 issue 清零 | ☑ |
| 6 | Error code 统一 | ☑ |
| 7 | 回归测试 | ☑（1 个已知问题）|
| 8 | 发布说明 | ☑ |

---

*Last updated: 2026-02-12*
